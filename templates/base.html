<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MarComect Strategy</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        :root { --brand-primary: #4f46e5; --brand-bg: #f8fafc; }
        body { font-family: 'Inter', sans-serif; background-color: var(--brand-bg); }
        .navbar { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(10px); border-bottom: 1px solid #e2e8f0; }
        .navbar-brand { font-weight: 800; color: var(--brand-primary) !important; }
        .btn { border-radius: 10px; font-weight: 600; }
        .notif-badge { position: absolute; top: -5px; right: -5px; font-size: 0.65rem; }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg sticky-top py-3">
        <div class="container-fluid px-4">
            <a class="navbar-brand" href="/">MARCOMECT STRATEGY</a>
            <div class="ms-auto d-flex align-items-center gap-3">
                {% if session.get('user_id') %}
                <button class="btn btn-link position-relative text-secondary p-0" onclick="openModal('notif-modal')">
                    <i class="bi bi-bell h5"></i>
                    {% if notification_count > 0 %}<span class="badge rounded-pill bg-danger notif-badge">{{ notification_count }}</span>{% endif %}
                </button>
                <div class="dropdown">
                    <button class="btn btn-white shadow-sm dropdown-toggle rounded-pill" type="button" data-bs-toggle="dropdown">
                        {{ session.get('username') }}
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end shadow border-0 rounded-4 mt-2">
                        {% if session.get('role') == 'admin' %}
                        <li><a class="dropdown-item py-2" href="#" onclick="openModal('user-modal')"><i class="bi bi-people me-2"></i> User Management</a></li>
                        <li><a class="dropdown-item py-2" href="#" onclick="openModal('group-modal')"><i class="bi bi-collection me-2"></i> Team Management</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item py-2 text-warning" href="{{ url_for('admin_backup_download') }}"><i class="bi bi-download me-2"></i> Backup DB</a></li>
                        {% endif %}
                        <li><a class="dropdown-item py-2 text-danger" href="{{ url_for('logout') }}"><i class="bi bi-box-arrow-right me-2"></i> Logout</a></li>
                    </ul>
                </div>
                {% endif %}
            </div>
        </div>
    </nav>
    <div class="container-fluid py-4 px-4">{% block content %}{% endblock %}</div>

    <div class="modal fade" id="user-modal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content border-0 shadow-lg"><div class="modal-body p-4">
        <h5 class="fw-bold mb-3">Add Strategy User</h5>
        <form id="add-user-form"><input type="email" id="au_email" class="form-control mb-2" placeholder="Email" required><input type="password" id="au_pass" class="form-control mb-3" placeholder="Password" required><button type="submit" class="btn btn-primary w-100">Create</button></form>
    </div></div></div></div>

    <div class="modal fade" id="notif-modal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content border-0 shadow-lg"><div class="modal-header border-0"><h6 class="fw-bold">My Roadmaps</h6><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body p-0"><div class="list-group list-group-flush">{% for t in my_pending_tasks %}<div class="list-group-item"><b>{{ t.name }}</b><br><small>{{ t.sprint.name }}</small></div>{% else %}<div class="p-5 text-center text-muted">All clear!</div>{% endfor %}</div></div></div></div></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function openModal(id) {
            const modalEl = document.getElementById(id);
            const modal = bootstrap.Modal.getInstance(modalEl) || new bootstrap.Modal(modalEl);
            modal.show();
        }
    </script>
</body>
</html>